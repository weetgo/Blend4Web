if(b4w.module_check("game_config"))throw"Failed to register module: game_config";
b4w.register("game_config",function(a){a.f=5;a.e=new Float32Array([0,0,-1]);a.eb=new Float32Array([0,0,.25]);a.gb=new Float32Array([0,0,0,1]);a.hb=.6;a.pa=2;a.Na=.2;a.Ma=new Float32Array([0,4,1.5]);a.Ta=new Float32Array([0,0,.5]);a.n=100;a.Pa=.5;a.Ra=35;a.Oa=12;a.j=0;a.v=1;a.i=2;a.Ab=2;a.xb=20;a.yb=.75;a.K=10;a.oa=.5;a.G=.01;a.Ka=.5;a.Ha=30;a.Ja=10;a.T=.33;a.Ia=15;a.S=10;a.Ga=3;a.ra=.9;a.ja=1;a.tb=.2;a.sb=1;a.B=.5;a.ob=20;a.mb=30;a.A=3;a.rb=100;a.r=0;a.C=1;a.ea=2;a.k=3;a.D=0;a.fa=1;a.ga=2;a.ha=["potion_hp",
"potion_hp.001","potion_hp.002"];a.qa=["potion_def"];a.ia=["potion_lava"];a.ba=["golem","golem.001","golem.002"];a.w=["golem_death"];a.lb=["golem_death_armature"];a.kb=["golem_death_blow"];a.s=["lava_rock","lava_rock.001"];a.u=["rock_01","rock_02","rock_03"];a.La=["burst_emitter_01","burst_emitter_02","burst_emitter_03"];a.ka=["mark_01","mark_02","mark_03"];a.da="golem_spawn golem_spawn.011 golem_spawn.010 golem_spawn.009 golem_spawn.001 golem_spawn.008 golem_spawn.002 golem_spawn.006 golem_spawn.007 golem_spawn.003 golem_spawn.005 golem_spawn.014 golem_spawn.013 golem_spawn.004 golem_spawn.012".split(" ");
a.ca="golem_spawn golem_patrol golem_patrol.001 golem_patrol.002 golem_patrol.003 golem_spawn.001 golem_patrol.004 golem_patrol.005 golem_patrol.006 golem_patrol.007 golem_spawn.002 golem_patrol.008 golem_patrol.009 golem_patrol.010 golem_patrol.011 golem_spawn.003 golem_patrol.012 golem_patrol.013 golem_patrol.014 golem_patrol.015 golem_spawn.004 golem_patrol.016 golem_patrol.017 golem_patrol.018 golem_patrol.019".split(" ");a.J=a.ca.length/a.f;a.aa="gem_0 gem_1 gem_2 gem_3 gem_4 gem_multi".split(" ");
a.$a="gem_0 gem_1 gem_2 gem_3 gem_4 gem_multi".split(" ");a.q=0;a.ib=1;a.jb=2;a.na=4;a.H=["BG","PG","RG","GG","YG"];a.I=3;a.F=["enviroment","islands","island_shield_0"];a.sa="shutter_glass";a.Bb="glass_shutter_emitter";a.Xa="character_run";a.Qa="sword_miss";a.X=["character_voice_atack_01","character_voice_atack_02","character_voice_atack_03"];a.Y=["character_voice_hurt_01","character_voice_hurt_02"];a.Z=["character_voice_jump_01","character_voice_jump_02"];a.Za="sword_hit";a.Sa="character_voice_death_01";
a.Va="character_jump_ends";a.fb="gem_pickup";a.bb="gem_mount";a.Ua="bonus_heal";a.Wa="bonus_lava";a.Ya="bonus_shield";a.vb="island_shield_grow";a.ub="golem_walk";a.nb="golem_atack_miss";a.qb="golem_atack_hit";a.pb="golem_getout";a.zb=["rock_hit_01","rock_hit_02","rock_hit_03"];a.ab="gem_destroy";a.Cb="final_win";a.ma="level_01_bm_intro";a.la="level_01_bm_end";a.wb=["level_01_bm_loop_A","level_01_bm_loop_B","level_01_bm_loop_C","level_01_bm_loop_D","level_01_bm_percussive"];a.U=0;a.V=1;a.W=2});if(b4w.module_check("obelisks"))throw"Failed to register module: obelisks";
b4w.register("obelisks",function(a,b){function A(){for(var c=0;c<e.f;c++){var a=e.F;a[2]="island_shield_"+c;a=f.get_object_by_dupli_name_list(a);m.stop(a);m.set_behavior(a,m.AB_FINISH_STOP)}}function z(c,a){var b="obelisk_"+c;if(0<a){var m=e.H[c]+"_0"+(w[c]+1),b=f.get_object_by_dupli_name(b,m);f.show_object(b);x.play_def(v);q[c]=e.I}else if(0>a){m=e.H[c]+"_0"+w[c];b=f.get_object_by_dupli_name(b,m);f.hide_object(b);var m=C,l=g;d.get_translation(b,m);d.get_rotation(b,l);t(m,l)}w[c]+=a;k(c)}function k(a){if(n(a)&&
!y.Nb(a)){var d=e.F;d[2]="island_shield_"+a;d=f.get_object_by_dupli_name_list(d);m.play(d);a=f.get_object_by_dupli_name("obelisk_"+a,e.vb);x.play_def(a);a:{for(a=0;a<e.f;a++)if(!n(a)){a=!1;break a}a=!0}a&&(r.disable_controls(),c.va(),x.clear_playlist(),a=f.get_object_by_name(e.Cb),x.play_def(a),a=r.g(),m.apply(a.rig,"character_idle_01"),m.set_behavior(a.rig,m.AB_CYCLIC),m.play(a.rig),l())}}function t(c,a){var b=f.get_object_by_dupli_name(e.sa,e.Bb);d.set_translation_v(b,c);d.set_rotation_v(b,a);f.show_object(b);
m.play(b,function(){f.hide_object(b)});var g=f.get_object_by_dupli_name(e.sa,e.ab);x.play_def(g)}function l(){p.Xb();u.check_sensor_manifold(null,"UPDATE_VIC_INTERFACE")&&u.remove_sensor_manifold(null,"UPDATE_VIC_INTERFACE");u.create_sensor_manifold(null,"UPDATE_VIC_INTERFACE",u.CT_SHOT,[u.create_timer_sensor(3)],null,function(){p.Kb();p.Ea()})}function n(c){return w[c]==e.na}function B(){for(var c=0;c<e.f;c++){w[c]=0;for(var a=1;a<=e.na;a++){var d=f.get_object_by_dupli_name("obelisk_"+c,e.H[c]+"_0"+
a);f.hide_object(d)}a=e.F;a[2]="island_shield_"+c;a=f.get_object_by_dupli_name_list(a);m.set_frame(a,0)}}var u=b("controls"),f=b("scenes"),m=b("animation"),x=b("sfx"),d=b("transform"),e=b("game_config"),r=b("character"),y=b("golems"),c=b("environment"),p=b("interface"),w=new Uint16Array([0,0,0,0,0]),q=new Uint16Array(5),v=null,C=new Float32Array(3),g=new Float32Array(4);a.init=function(){B();var c=r.g();A();var a=u.create_collision_sensor(c.a,"OBELISK");u.create_sensor_manifold(c.a,"FILL_OBELISK",
u.CT_TRIGGER,[a],null,function(a,d,b){1!=b||!c.c||n(c.island)||c.c.id!=c.island&&5!=c.c.id||(r.Qb(),z(c.island,1))});for(a=0;a<q.length;a++)q[a]=e.I;v=f.get_object_by_dupli_name("character",e.bb)};a.Hb=z;a.Yb=k;a.xa=n;a.za=function(c){return w[c]};a.Jb=function(c){--q[c]||(q[c]=e.I,z(c,-1))}});if(b4w.module_check("gems"))throw"Failed to register module: gems";
b4w.register("gems",function(a,b){function A(a){return f[a].state==n.q&&(!B.xa(a)||5==a)}var z=b("controls"),k=b("scenes");b("animation");b("sfx");var t=b("transform");b("util");var l=b("constraints");b("vec3");var n=b("game_config"),B=b("obelisks"),u=b("character"),f=[];a.init=function(){function a(d,c,b,f){1==b&&u.Db(f)}for(var b=0;b<n.aa.length;b++){var d=n.aa[b],e=n.$a[b],l=k.get_object_by_name(d),d=k.get_object_by_dupli_name(d,e),l={empty:l,Zb:d,id:b,state:n.q};f.push(l);e=z.create_collision_sensor(d,
"CHARACTER");z.create_sensor_manifold(d,"PICK_GEM",z.CT_TRIGGER,[e],null,a,l)}};a.R=function(a){for(var b=0,d=0;d<f.length;d++)A(d)&&b++;if(b)for(b=Math.floor(b*Math.random()),d=0;d<f.length;d++)if(A(d)&&0==b--){d=f[d];t.set_translation_v(d.empty,a);d.state=n.jb;break}};a.reset=function(){for(var a=0;a<f.length;a++){var b=f[a],d=b.empty;l.remove(d);t.set_translation_v(d,n.e);b.state=n.q}}});if(b4w.module_check("interface"))throw"Failed to register module: interface";
b4w.register("interface",function(a,b){function A(a){var b=1;function f(){var d=m-n.get_timeline();0>d?l.remove_sensor_manifold(null,"SHOW_"+a.id):a.style.opacity=1-d/b}b=b||0;a.style.opacity=0;a.style.visibility="visible";var m=n.get_timeline()+b;if(!l.check_sensor_manifold(null,"SHOW_"+a.id)){var k=l.create_elapsed_sensor();l.create_sensor_manifold(null,"SHOW_"+a.id,l.CT_CONTINUOUS,[k],null,f)}}function z(a,b){function f(){var d=x-n.get_timeline();0>d?(a.style.visibility="hidden",l.remove_sensor_manifold(null,
"HIDE_"+a.id)):a.style.opacity=d/b*k}b=b||0;var k=a.style.opacity,x=n.get_timeline()+b;if(!l.check_sensor_manifold(null,"HIDE_"+a.id)){var d=l.create_elapsed_sensor();l.create_sensor_manifold(null,"HIDE_"+a.id,l.CT_CONTINUOUS,[d],null,f)}}var k=b("character"),t=b("game_config"),l=b("controls"),n=b("time");a.ac=function(){l.create_timer_sensor(1)};a.Fa=function(){var a;a=k.g().b;var b=document.getElementById("life_bar_green"),f=document.getElementById("life_bar_red"),l=document.getElementById("life_bar_mid"),
n=192/t.n,d=Math.max(a*n,0);a=Math.min((t.n-a)*n,192);b.style.width=d+"px";f.style.width=a+"px";l.style.left=d+19+"px"};a.Wb=function(a,b,f,k,n,d){function e(g){g.preventDefault();g=g.changedTouches;for(var e=0;e<g.length;e++)g[e].identifier==t?(l.set_custom_sensor(b,0),l.set_custom_sensor(k,0),l.set_custom_sensor(f,0),l.set_custom_sensor(a,0),w.style.visibility="hidden",q.style.visibility="hidden",t=null):g[e].identifier==c?(l.set_custom_sensor(n,0),c=null):g[e].identifier==p&&(l.set_custom_sensor(d,
0),p=null)}var r=new Float32Array(2),t,c,p,w=document.getElementById("control_tap"),q=document.getElementById("control_circle"),v=w.clientWidth/2,C=q.clientWidth/2;document.getElementById("canvas3d").addEventListener("touchstart",function(a){a.preventDefault();var c=window.innerWidth;a=a.changedTouches;for(var b=0;b<a.length;b++){var d=a[b],f=d.clientX,e=d.clientY;if(f>c/2)break;r[0]=f;r[1]=e;t=d.identifier;w.style.visibility="visible";w.style.left=f-v+"px";w.style.top=e-v+"px";q.style.visibility=
"visible";q.style.left=f-C+"px";q.style.top=e-C+"px"}},!1);document.getElementById("control_jump").addEventListener("touchstart",function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;b++){var d=a[b];l.set_custom_sensor(n,1);c=d.identifier}},!1);document.getElementById("control_attack").addEventListener("touchstart",function(a){a.preventDefault();a=a.changedTouches;for(var c=0;c<a.length;c++){var b=a[c];l.set_custom_sensor(d,1);p=b.identifier}},!1);document.getElementById("canvas3d").addEventListener("touchmove",
function(c){c.preventDefault();l.set_custom_sensor(b,0);l.set_custom_sensor(k,0);l.set_custom_sensor(f,0);l.set_custom_sensor(a,0);var d=window.innerWidth;c=c.changedTouches;for(var e=0;e<c.length;e++){var p=c[e],q=p.clientX,p=p.clientY;if(q>d/2)break;w.style.left=q-v+"px";w.style.top=p-v+"px";var q=q-r[0],p=p-r[1],n=Math.sqrt(q*q+p*p);if(16>n)break;q/=n;p=-p/n;q>Math.cos(3*Math.PI/8)?l.set_custom_sensor(a,1):q<-Math.cos(3*Math.PI/8)&&l.set_custom_sensor(f,1);p>Math.sin(Math.PI/8)?l.set_custom_sensor(b,
1):p<-Math.sin(Math.PI/8)&&l.set_custom_sensor(k,1)}},!1);document.getElementById("canvas3d").addEventListener("touchend",e,!1);document.getElementById("controls").addEventListener("touchend",e,!1);document.getElementById("control_jump").style.visibility="visible";document.getElementById("control_attack").style.visibility="visible"};a.Pb=function(a){document.getElementById("replay").addEventListener("touchstart",a,!1);document.getElementById("replay").addEventListener("click",a,!1)};a.Ea=function(){A(document.getElementById("replay"))};
a.$b=function(a){z(document.getElementById("replay"),a)};a.Xb=function(){A(document.getElementById("victory"))};a.Kb=function(){z(document.getElementById("victory"),1)}});if(b4w.module_check("bonuses"))throw"Failed to register module: bonuses";
b4w.register("bonuses",function(a,b){function A(a){function b(a,c,f,g){if(1==f)switch(t.set_translation_v(g.empty,k.e),g.type){case k.U:u.Eb();B.play_def(m);break;case k.V:r<=k.ja&&u.Fb();r=k.Ia;B.play_def(x);break;case k.W:e<=k.ra&&u.Gb(),e=k.Ja,B.play_def(d)}}function w(a,c,b,d){a=l.get_sensor_value(a,c,0);d.p-=a;0<d.p?(a=d.p,4<a||(d=d.body,a*=k.Ga,.5<(1>a?a:a%Math.floor(a))?n.hide_object(d):n.show_object(d))):t.set_translation_v(d.empty,k.e)}for(var q=0;q<f.length;q++){var v=f[q],C=v.body,g=l.create_collision_sensor(C,
"CHARACTER");l.create_sensor_manifold(C,"BONUS",l.CT_TRIGGER,[g],null,b,v);l.create_sensor_manifold(C,"BONUS_LIFETIME",l.CT_CONTINUOUS,[a],null,w,v)}}function z(a,b,d){for(var e=0;e<a.length;e++){var l=a[e],m=b,g=d,r=n.get_object_by_name(l),l=n.get_object_by_dupli_name(l,g);f.push({empty:r,body:l,p:k.S,type:m})}}var k=b("game_config"),t=b("transform"),l=b("controls"),n=b("scenes"),B=b("sfx"),u=b("character"),f=[],m=null,x=null,d=null,e=0,r=0,y=new Float32Array(3);a.init=function(a){m=n.get_object_by_dupli_name("character",
k.Ua);x=n.get_object_by_dupli_name("character",k.Wa);d=n.get_object_by_dupli_name("character",k.Ya);z(k.ha,k.U,"potion_HP");z(k.ia,k.V,"potion_LAVA");z(k.qa,k.W,"potion_SHIELD");A(a);l.create_sensor_manifold(null,"BONUS_TIMER",l.CT_CONTINUOUS,[a],null,function(a,c){var b=l.get_sensor_value(a,c,0);0<e&&(e-b<k.ra&&u.Sb(),e-=b);0<r&&(r-b<k.ja&&u.Rb(),r-=b)})};a.R=function(a){for(var b=Math.floor(3*Math.random()),d=0;d<f.length;d++){var e=f[d],l=e.empty,m=y;t.get_translation(l,m);if(-1==m[2]&&e.type==
b){a[2]+=.05;t.set_translation_v(l,a);e.p=k.S;n.show_object(e.body);break}}};a.reset=function(){function a(c){for(var b=0;b<c.length;b++){var d=n.get_object_by_name(c[b]);t.set_translation_v(d,k.e)}}a(k.ha);a(k.qa);a(k.ia)};a.Vb=function(){e=0};a.Ub=function(){r=0};a.ya=function(){return r};a.P=function(){return e}});if(b4w.module_check("golems"))throw"Failed to register module: golems";
b4w.register("golems",function(a,b){function A(a,b){if(0>=a.b){var e=a.empty,g=f.get_object_by_name(c.w),n=f.get_object_by_dupli_name(c.w,c.lb),D=f.get_object_by_dupli_name(c.w,c.kb),h=F,y=I;d.get_translation(e,h);d.get_rotation(e,y);d.set_translation_v(g,h);d.set_rotation_v(g,y);m.apply(n,"golem_death");m.set_behavior(n,m.AB_FINISH_STOP);m.play(n);m.play(D);x.stop(a.m);d.set_translation_v(e,c.e);C.R(h);a.d=-1;a.b=100;l(a,c.k);q.Hb(a.d,0)}else switch(a.state){case c.C:!a.L&&m.get_frame(a.rig)>=c.mb&&
(a.l==c.fa?w.Ib(a.ta,p.g().a,c.B)&&(e=c.ob,0<v.P()&&(e*=c.T),p.M(-e),x.play_def(a.O)):a.l==c.ga&&(e=a.d,q.za(e)&&q.Jb(e),x.play_def(a.O)),a.L=!0);break;case c.r:if(e=u.get_sensor_value(a,b,0),g=p.g(),n=a.d,g.island==n&&0<g.b)z(a,g.a,e),a.l=c.fa;else if(q.za(n))g=f.get_object_by_dupli_name("obelisk_"+n,"obelisk"),z(a,g,e),a.l=c.ga;else{n=a.o;g=F;d.get_translation(a.empty,g);if(!(.05<r.distance(g,n)&&a.l==c.D)){a.l=c.D;a:{for(var n=a.o,D=a.N,h=a.d,y=Math.random(),B=Math.floor(c.J*y),A=0,y=0;y<c.J;y++)if(y!=
D&&A++==B){D=f.get_object_by_name(c.ca[c.J*h+y]);d.get_translation(D,n);n[2]=g[2];a.N=y;break a}a.N=-1}}k(a,e);t(a,e)}}}function z(a,b,e){var f=F,g=G;d.get_translation(a.empty,f);d.get_translation(b,g);g[2]=f[2];a.o.set(g);b=r.distance(f,g);f=k(a,e);b>=c.B?t(a,e):f<.05*Math.PI&&(e=a.empty,b=a.ta,f=F,g=G,a.L=!1,l(a,c.C),d.get_translation(e,f),r.scaleAndAdd(f,g,c.B,b),b[2]+=.3,x.is_play(a.m)&&x.stop(a.m),x.play_def(a.ua))}function k(a,b){var f=a.empty,g=a.o,l=F,k=G,h=H,n=I,m=E;d.get_translation(f,l);
d.get_rotation(f,n);r.transformQuat(e.AXIS_MY,n,k);r.subtract(g,l,h);r.normalize(h,h);y.rotationTo(k,h,m);y.multiply(m,n,m);g=r.dot(k,h);g=Math.acos(1<g?1:-1>g?-1:g);y.slerp(n,m,Math.min(b/(Math.abs(g)/Math.PI)*c.sb,1),m);d.set_rotation_v(f,m);return g}function t(a,b){var g=F,f=G,l=I,k=a.empty,h=a.m;d.get_rotation(k,l);d.get_translation(k,g);r.transformQuat(e.AXIS_MY,l,f);r.scaleAndAdd(g,f,c.tb*b,g);d.set_translation_v(k,g);x.is_play(h)||(x.play_def(h),x.cyclic(h,!0))}function l(a,b){var d=a.rig;
switch(b){case c.r:m.apply(d,"golem_walk");m.set_behavior(d,m.AB_CYCLIC);m.play(d);break;case c.C:var e=Math.floor(3*Math.random())+1;m.apply(d,"golem_atack_0"+e);m.play(d,function(){a.state!=c.k&&l(a,c.r)});break;case c.ea:m.apply(d,"golem_getout"),m.play(d,function(){a.state!=c.k&&l(a,c.r)})}a.state=b}function n(){for(var a=c.f,b=0;b<g.length;b++)B(b)||a--;if(0==a)return null;for(var a=Math.floor(Math.random()*a),d=0,b=0;b<c.f;b++)if(B(b)&&d++==a)return b;return null}function B(a){for(var c=0;c<
g.length;c++)if(g[c].d==a)return!1;return q.xa(a)?!1:!0}var u=b("controls"),f=b("scenes"),m=b("animation"),x=b("sfx"),d=b("transform"),e=b("util"),r=b("vec3"),y=b("quat"),c=b("game_config"),p=b("character"),w=b("combat"),q=b("obelisks"),v=b("bonuses"),C=b("gems"),g=[],F=new Float32Array(3),G=new Float32Array(3),H=new Float32Array(3),I=new Float32Array(4),E=new Float32Array(4),D=0;a.init=function(a){D=c.A;for(var b=0;b<c.ba.length;b++){var d=c.ba[b],e=f.get_object_by_name(d),l=f.get_object_by_dupli_name(d,
"golem_collider"),k=f.get_object_by_dupli_name(d,"golem_armature"),e={body:l,rig:k,empty:e,b:c.rb,d:-1,N:0,o:new Float32Array(3),l:c.D,state:c.k,ta:new Float32Array(3),L:!1,m:null,ua:null,O:null,wa:null};e.m=f.get_object_by_dupli_name(d,c.ub);e.ua=f.get_object_by_dupli_name(d,c.nb);e.O=f.get_object_by_dupli_name(d,c.qb);e.wa=f.get_object_by_dupli_name(d,c.pb);u.create_sensor_manifold(e,"GOLEM",u.CT_CONTINUOUS,[a],null,A);g.push(e)}w.Tb(g)};a.Lb=function(a){for(var b=[],e=[],k=0;k<c.da.length;k++){var m=
f.get_object_by_name(c.da[k]),p=d.get_translation(m),m=d.get_rotation(m);b.push(p);e.push(m)}u.create_sensor_manifold(null,"GOLEMS_SPAWN",u.CT_CONTINUOUS,[a],null,function(a,f){var k;a:{for(var m=0;m<g.length;m++)if(k=g[m],k.state==c.k)break a;k=null}if(k&&(m=u.get_sensor_value(a,f,0),D-=m,0>=D&&(D=c.A,m=n(),null!=m))){var p=k.empty,r=b.length/c.f,q=Math.floor(Math.random()*r),q=r*m+q,r=b[q],q=e[q];d.set_translation_v(p,r);d.set_rotation_v(p,q);l(k,c.ea);x.play_def(k.wa);k.d=m;k.o.set(r)}})};a.reset=
function(){D=c.A;for(var a=0;a<g.length;a++){var b=g[a];b.d=-1;l(b,c.k);d.set_translation_v(b.empty,c.e);x.stop(b.m)}};a.Nb=function(a){for(var c=0;c<g.length;c++)if(g[c].d==a)return!0;return!1}});if(b4w.module_check("combat"))throw"Failed to register module: combat";b4w.register("combat",function(a,b){function A(a,b,f){var m=l;z.get_translation(b,m);return k.distance(m,a)<f?!0:!1}var z=b("transform"),k=b("vec3"),t=b("game_config"),l=new Float32Array(3),n=null;a.Tb=function(a){n=a};a.Ob=function(a,b){for(var f=0;f<n.length;f++){var k=n[f];if(!(0>=k.b)&&A(a,k.empty,b))return k.b-=t.Ra,!0}return!1};a.Ib=A});if(b4w.module_check("character"))throw"Failed to register module: character";
b4w.register("character",function(a,b){function A(){function a(c,b,d){h.island=1==d?parseInt(b[b.length-1]):-1}for(var c=0;c<g.f;c++){var b=d.create_collision_sensor(h.Aa,"ISLAND"+c);d.create_sensor_manifold(h.Aa,"ISLE_COLL"+c,d.CT_TRIGGER,[b],null,a)}}function z(a){var c=d.create_ray_sensor(h.a,[0,0,0],[0,0,-.3],"ISLAND",!0),b=d.create_ray_sensor(h.a,[0,0,0],[0,0,-.3],"LAVA",!0);d.create_sensor_manifold(h.a,"GROUND SENS",d.CT_TRIGGER,[c,b],function(a){return a[0]||a[1]},function(c,b,e){d.set_custom_sensor(a,
1==e?1:0)})}function k(a,b,e){function f(a,b,e){if(h.state==g.i)y.set_character_move_dir(a,0,0);else{var k=d.get_sensor_value(a,b,6);if(1==e){switch(b){case "FORWARD":var l=1;break;case "BACKWARD":l=-1}h.state==g.j&&k&&(c.apply(h.rig,"character_run"),c.play(h.rig),c.set_behavior(h.rig,c.AB_CYCLIC));h.state=g.v}else l=0,h.state==g.v&&k&&(c.apply(h.rig,"character_idle_01"),c.set_behavior(h.rig,c.AB_CYCLIC),c.play(h.rig)),h.state=g.j;l&&k?p.is_play(E)||p.play_def(E):p.is_play(E)&&p.stop(E);y.set_character_move_dir(a,
l,0)}}var k=d.create_keyboard_sensor(d.KEY_W),l=d.create_keyboard_sensor(d.KEY_S),m=d.create_keyboard_sensor(d.KEY_UP),n=d.create_keyboard_sensor(d.KEY_DOWN);a=[k,m,a,l,n,b,e];d.create_sensor_manifold(h.a,"FORWARD",d.CT_CONTINUOUS,a,function(a){return a[0]||a[1]||a[2]},f);d.create_sensor_manifold(h.a,"BACKWARD",d.CT_CONTINUOUS,a,function(a){return a[3]||a[4]||a[5]},f);c.apply(h.rig,"character_idle_01");c.play(h.rig);c.set_behavior(h.rig,c.AB_CYCLIC);c.apply(h.body,"HEAL_run");c.apply(h.body,"LAVA_grow",
c.SLOT_1);c.apply(h.body,"SHIELD_grow",c.SLOT_2);c.apply(h.h,"SHIELD_GLOW_grow");p.stop(E)}function t(a,c,b){function e(a,c,b){if(h.state!=g.i){var f=d.get_sensor_value(a,"LEFT",6);if(1==b)switch(c){case "LEFT":y.character_rotation_inc(a,f*g.pa,0);break;case "RIGHT":y.character_rotation_inc(a,-f*g.pa,0)}}}var f=d.create_keyboard_sensor(d.KEY_A),k=d.create_keyboard_sensor(d.KEY_D),l=d.create_keyboard_sensor(d.KEY_LEFT),m=d.create_keyboard_sensor(d.KEY_RIGHT);a=[f,l,c,k,m,a,b];d.create_sensor_manifold(h.a,
"LEFT",d.CT_CONTINUOUS,a,function(a){return a[0]||a[1]||a[2]},e);d.create_sensor_manifold(h.a,"RIGHT",d.CT_CONTINUOUS,a,function(a){return a[3]||a[4]||a[5]},e)}function l(a,b){var e=d.create_keyboard_sensor(d.KEY_SPACE);d.create_sensor_manifold(h.a,"JUMP",d.CT_SHOT,[e,a,b],function(a){return a[0]||a[1]},function(a,b){h.state!=g.i&&(y.character_jump(a),d.get_sensor_value(a,b,2)&&(b=Math.floor(2*Math.random()),p.play_def(N[b]),c.apply(h.rig,"character_jump"),c.set_behavior(h.rig,c.AB_FINISH_STOP),c.play(h.rig)))});
d.create_sensor_manifold(h.a,"LANDING",d.CT_SHOT,[b],null,function(){p.play_def(L);h.state==g.j?(c.apply(h.rig,"character_idle_01"),c.set_behavior(h.rig,c.AB_CYCLIC),c.play(h.rig)):h.state==g.v&&(c.apply(h.rig,"character_run"),c.set_behavior(h.rig,c.AB_CYCLIC),c.play(h.rig))})}function n(a,b){function e(){c.apply(h.rig,"character_idle_01");c.set_behavior(h.rig,c.AB_CYCLIC);c.play(h.rig);h.state=g.j}var f=d.create_keyboard_sensor(d.KEY_ENTER),k=!1;d.create_sensor_manifold(h.a,"ATTACK",d.CT_TRIGGER,
[f,a],function(a){return a[0]||a[1]},function(a,b,d){1==d&&h.state!=g.i&&(h.state=g.i,a=Math.floor(3*Math.random())+1,c.apply(h.rig,"character_atack_0"+a),c.set_behavior(h.rig,c.AB_FINISH_STOP),c.play(h.rig,e),y.set_character_move_dir(h.a,0,0),k=!1,p.is_play(E)&&p.stop(E),p.play_def(D),a=Math.floor(3*Math.random()),p.play_def(O[a]))});d.create_sensor_manifold(h.a,"DAMAGE_GOLEMS",d.CT_CONTINUOUS,[b],null,function(){if(h.state==g.i&&!k&&c.get_frame(h.rig)>=g.Oa){var a=R,b=S,d=T,e=J,f=g.Pa;w.get_translation(h.a,
a);w.get_rotation(h.a,e);v.transformQuat(q.AXIS_MY,e,b);v.scaleAndAdd(a,b,f,d);F.Ob(d,f)&&p.play_def(K);k=!0}})}function B(){d.check_sensor_manifolds(h.a)&&d.remove_sensor_manifold(h.a);y.set_character_move_dir(h.a,0,0);p.stop(E)}function u(){c.apply(h.body,"LAVA_fall",c.SLOT_1);c.set_behavior(h.body,c.AB_FINISH_STOP,c.SLOT_1);c.play(h.body,null,c.SLOT_1);H.Ub()}function f(){c.apply(h.body,"SHIELD_flash",c.SLOT_2);c.set_behavior(h.body,c.AB_FINISH_STOP,c.SLOT_2);c.play(h.body,null,c.SLOT_2);c.apply(h.h,
"SHIELD_GLOW_fall");c.set_behavior(h.h,c.AB_FINISH_STOP);c.play(h.h);H.Vb()}function m(a){if(!(0>=h.b)){var b=r.get_timeline();if(0>a&&Q<b-.5){var d=Math.floor(2*Math.random());p.play_def(P[d]);Q=b}h.b+=a;h.b=Math.min(h.b,g.n);0>=h.b&&(B(),I.va(),p.clear_playlist(),a=e.get_object_by_dupli_name("enviroment",g.ma),p.stop(a),a=e.get_object_by_dupli_name("enviroment",g.la),b=e.get_object_by_dupli_name("character",g.Sa),p.play_def(a),p.play_def(b),c.apply(h.rig,"character_death"),c.set_behavior(h.rig,
c.AB_FINISH_STOP),c.play(h.rig),G.Ea(),h.c&&x(),0<H.P&&f(),0<H.ya&&u());G.Fa()}}function x(){var a=h.c.empty;C.remove(a);w.set_translation_v(a,g.e);w.set_scale(a,1);h.c.state=g.q;h.c=null}var d=b("controls"),e=b("scenes"),r=b("time"),y=b("physics"),c=b("animation"),p=b("sfx"),w=b("transform"),q=b("util"),v=b("vec3"),C=b("constraints"),g=b("game_config"),F=b("combat"),G=b("interface"),H=b("bonuses"),I=b("environment"),E=null,D=null,K=null,L=null,M=null,N=[],O=[],P=[],h=null,Q=-100,R=new Float32Array(3),
S=new Float32Array(3),T=new Float32Array(3),J=new Float32Array(4);a.Mb=function(){h={a:e.get_first_character(),rig:e.get_object_by_dupli_name("character","character_rig"),body:e.get_object_by_dupli_name("character","character_body"),Aa:e.get_object_by_dupli_name("character","character_picker"),h:e.get_object_by_dupli_name("character","shield_sphere"),b:g.n,state:g.j,c:null,island:-1}};a.Ba=function(a){E=e.get_object_by_dupli_name("character",g.Xa);D=e.get_object_by_dupli_name("character",g.Qa);K=
e.get_object_by_dupli_name("character",g.Za);L=e.get_object_by_dupli_name("character",g.Va);M=e.get_object_by_dupli_name("character",g.fb);for(var b=0;b<g.Z.length;b++){var c=e.get_object_by_dupli_name("character",g.Z[b]);N.push(c)}for(b=0;b<g.X.length;b++)c=e.get_object_by_dupli_name("character",g.X[b]),O.push(c);for(b=0;b<g.Y.length;b++)c=e.get_object_by_dupli_name("character",g.Y[b]),P.push(c);A();var b=d.create_custom_sensor(0),c=d.create_custom_sensor(0),f=d.create_custom_sensor(0),h=d.create_custom_sensor(0),
m=d.create_custom_sensor(0),p=d.create_custom_sensor(0),r=d.create_custom_sensor(0);z(r);(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&G.Wb(b,f,c,h,m,p);k(f,h,r);t(b,c,a);l(m,r);n(p,a)};a.disable_controls=B;a.reset=function(){h.state=g.j;h.b=g.n;h.island=-1;w.get_rotation(h.a,
J);y.set_transform(h.a,g.Ta,J);y.set_character_move_dir(h.a,0,0)};a.Eb=function(){m(g.Ha);c.play(h.body)};a.Fb=function(){c.apply(h.body,"LAVA_grow",c.SLOT_1);c.set_behavior(h.body,c.AB_FINISH_STOP,c.SLOT_1);c.play(h.body,null,c.SLOT_1)};a.Rb=u;a.Gb=function(){c.apply(h.body,"SHIELD_grow",c.SLOT_2);c.set_behavior(h.body,c.AB_FINISH_STOP,c.SLOT_2);c.play(h.body,null,c.SLOT_2);c.apply(h.h,"SHIELD_GLOW_grow");c.set_behavior(h.h,c.AB_FINISH_STOP);c.play(h.h)};a.Sb=f;a.M=m;a.Db=function(a){var b=a.empty;
if(h.c){if(h.c==a)return;x()}b=a.empty;C.append_stiff(b,h.a,g.eb,g.gb,g.hb);a.state=g.ib;h.c=a;p.play_def(M)};a.Qb=x;a.g=function(){return h}});if(b4w.module_check("environment"))throw"Failed to register module: environment";
b4w.register("environment",function(a,b){function A(a){var b=x;b[0]=8*Math.random()-4;b[1]=8*Math.random()-4;b[2]=4*Math.random()+2;l.set_translation_v(a,b)}var z=b("animation"),k=b("controls"),t=b("scenes"),l=b("transform"),n=b("vec3"),B=b("sfx"),u=b("character"),f=b("game_config"),m=b("bonuses"),x=new Float32Array(3);a.Ca=function(a){function b(a,d){var e=k.get_sensor_value(a,d,0),g=t.get_object_name(a);c[g]+=e;c[g]<=f.oa||(g=x,l.get_translation(a,g),g[2]-=f.Ab*e,l.set_translation_v(a,g))}function r(a,
b,d,e){var g=x,p=e[0];e=e[1];l.get_translation(u.g().a,g);d=k.get_sensor_value(a,b,0)?0:1;b=k.get_sensor_payload(a,b,d).coll_pos;g=n.distance(g,b);l.set_translation_v(p,b);z.set_frame(p,0,z.SLOT_ALL);z.play(p,null,z.SLOT_ALL);A(a);g<f.yb&&(p=-f.xb,0<m.P()&&(p*=f.T),u.M(p));a=t.get_object_name(a);c[a]=0;(a=Math.random()<f.Ka)&&0==d&&m.R(b);B.play_def(e)}function y(a,b,d,e){d=k.get_sensor_value(a,b,0)?0:1;b=k.get_sensor_payload(a,b,d).hit_fract;d=x;var g=t.get_object_name(a);c[g]<=f.oa&&(l.get_translation(a,
d),d[2]-=b*f.K-.01,l.set_translation_v(e,d));l.set_scale(e,1-b)}for(var c={},p=0;p<f.s.length;p++)for(var w=f.s[p],q=0;q<f.u.length;q++){var v=f.u[q],C=f.La[q],g=f.ka[q],v=t.get_object_by_dupli_name(w,v),C=t.get_object_by_dupli_name(w,C),g=t.get_object_by_dupli_name(w,g),F=t.get_object_by_dupli_name(w,f.zb[q]),G=k.create_collision_sensor(v,"LAVA",!0),H=k.create_collision_sensor(v,"ISLAND",!0),I=k.create_ray_sensor(v,[0,0,0],[0,0,-f.K],"ISLAND",!0),E=k.create_ray_sensor(v,[0,0,0],[0,0,-f.K],"LAVA",
!0);k.create_sensor_manifold(v,"ROCK_FALL",k.CT_CONTINUOUS,[a],null,b);k.create_sensor_manifold(v,"ROCK_CRASH",k.CT_SHOT,[H,G],function(a){return a[0]||a[1]},r,[C,F]);k.create_sensor_manifold(v,"MARK_POS",k.CT_CONTINUOUS,[I,E],function(a){return a[0]||a[1]},y,g);A(v);v=t.get_object_name(v);c[v]=0}};a.Da=function(a){var b=0,l=u.g(),n=k.create_ray_sensor(l.a,[0,0,0],[0,0,-.3],"LAVA",!0);k.create_sensor_manifold(l.a,"LAVA_COLLISION",k.CT_CONTINUOUS,[n,a],function(a){return a[0]},function(a,d,l){1==l?
(a=k.get_sensor_value(a,d,1),b+=a,b>=f.G&&(a=a<f.G?1:Math.floor(a/f.G),0>=m.ya()&&u.M(-a),b=0)):b=0})};a.va=function(){for(var a=0;a<f.s.length;a++)for(var b=f.s[a],m=0;m<f.u.length;m++){var n=f.ka[m],c=t.get_object_by_dupli_name(b,f.u[m]),n=t.get_object_by_dupli_name(b,n);k.remove_sensor_manifold(c);A(c);l.set_translation_v(n,f.e)}}});if(b4w.module_check("game_example_main"))throw"Failed to register module: game_example_main";
b4w.register("game_example_main",function(a,b){function A(a,b){if(b){var c=n.get_std_assets_path()+"tutorials/making_a_game_p7-12/level_01.json";B.load(c,z,null,!0)}else x.log("b4w init failure")}function z(){r.Mb();var a=u.create_elapsed_sensor();y.init(a);p.init(a);p.Lb(a);w.init();q.init();r.Ba(a);v.Ca(a);v.Da(a);k();t();c.Pb(function(){document.getElementById("replay").style.visibility="hidden";u.remove_sensor_manifold(null,"PLAYLIST");r.reset();q.reset();y.reset();p.reset();r.Ba(a);w.init();
v.Da(a);v.Ca(a);c.Fa();t()})}function k(){var a=m.get_active_camera(),b=m.get_object_by_dupli_name("character","camera_target");f.append_semi_soft_cam(a,b,e.Ma,e.Na)}function t(){var a=m.get_object_by_dupli_name("enviroment",e.ma),b=m.get_object_by_dupli_name("enviroment",e.la);d.play_def(a);d.stop(b);a=d.get_duration(a)*d.get_playrate(a);u.create_sensor_manifold(null,"PLAYLIST",u.CT_SHOT,[u.create_timer_sensor(a)],null,function(){u.remove_sensor_manifold(null,"PLAYLIST");if(!(0>=r.g().b)){for(var a=
[],b=e.wb,c=0;c<b.length;c++){var f=m.get_object_by_dupli_name("enviroment",b[c]);a.push(f)}d.apply_playlist(a,0,!0)}})}var l=b("app"),n=b("config");b("main");var B=b("data");b("container");var u=b("controls"),f=b("constraints");b("input");var m=b("scenes"),x=b("print"),d=b("sfx");b("vec3");b("quat");var e=b("game_config"),r=b("character");b("combat");var y=b("bonuses"),c=b("interface"),p=b("golems"),w=b("obelisks"),q=b("gems"),v=b("environment");new Float32Array(3);new Float32Array(3);new Float32Array(3);
new Float32Array(3);new Float32Array(4);new Float32Array(4);a.init=function(){var a=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1;l.init({canvas_container_id:"canvas3d",callback:A,physics_enabled:!0,quality:a?n.P_LOW:n.P_HIGH,console_verbose:!0,show_fps:!0,autoresize:!0,
physics_use_workers:!a,alpha:!1})}});b4w.require("game_example_main").init();
